/** RESEARCH PROJECTS **/
var P1 = {
    Thema: "BIOSS",
    Thema_de: "BIOSS",
    title: "Biofeedback System for Thermal Strain",
    title_de: "Biofeedback System for Thermal Strain",
    description: "In sports, medicine and work thermal stress and hydration can be a performance inhibiting factor. Several studies prove a double edges problem due to transient conditions or under- or over-hydration that can cause health risks or even death. Due to the Zentrale Innovationsprogram Mittelstand (ZIM) of the Federal Ministry of Economic Affairs and Energy (BMWi), the Professorship of Sports Equipment and Materials of the Technische Universität München was granted a two year project. In cooperation with ciclosport® a new biofeedback system to monitor thermal stress in medicine, sports and work shall be developed. The goal is the development and combination of non invasive measuring methods to determine heat stress relevant parameters, such as body temperatures, heart frequency and sweat rate and/or their modelling. The integration of multiple factors shall lead to more reliable predictions of thermal strain and feedback on reasonable counteractions.",
    description_de:"In Sport, Medizin und Arbeit kann thermischer Stress und der menschliche Wasserhaushalt ein leistungsbestimmender Faktor sein. Diverse Studien belegen ambivalente Probleme durch zu hohe oder zu niedrige Temperaturen, sowie durch zu wenig oder zu viel Wasseraufnahme. Leistungseinschänkungen, Gesundheitsschäden oder gar der Tod können die Folge sein. Durch das Zentrale Innovationsprogramm des Bundesministeriums für Wirtschaft und Energie wurde der Professur Sportgeräte und Materialien der Technischen Universität München nun ein 2 Jahresprojekt genehmigt. In Kooperation mit der Fa. ciclosport® soll ein neues Biofeedbacksystem zur Überwachung des thermischen Stresses in Sport, Medizin und Arbeit entstehen. Ziel ist die Entwicklung und Kombination nicht invasiver Messverfahren zur Ermittlung hitzestressrelevanter Parameter, wie Körpertemperatur, Herzfrequenz und Schwitzrate und/oder deren Modellierung. Durch die integrative Berücksichtigung mehrerer Faktoren sollen zuverlässigere Aussagen über die thermische Belastung erreicht und Feedback für sinnvolle Gegenmaßnahmen ermöglicht werden.",
    leader: "Marius Janta; Stefanie Passler",
    partner: "Ciclosport",
    funding: "Public with industry",
    funding_de: "Öffentlich & Wirtschaft",
    status: "Running",
    status_de: "laufend",
    start: "01/07/2015",
    end: "30/06/2017",
    'Sportart 0': "Ausdauersport - Triathlon",
    'Sportart 1': "Radsport-Radfahren-Mountainbike",
    'Sportart 2': "Laufen & Trailrunning",
    'Forschungsziel 2': "Sicherheit",
    'Forschungsziel 1': "Nutzungserlebnis",
    'Forschungsziel 0': "",
    'Forschungsfeld 1': "Physiologie",
    'Forschungsfeld 2': "Materialwissenschaft",
    'Forschungsfeld 0': "Psychologie"
}

var P2 = {
    Thema: "Funtional Textils",
    Thema_de: "Funktionstextilien",
    title: "Functional Textils Measure Movement and Muscle Activation during Skiing",
    title_de: "Funktionstextilien messen Bewegung und Muskelaktivität beim Skifahren",
    description: "The Professorship, together with the School of Textiles & Design at the University Reutlingen, started a joint development project for new technical textiles. In the context of an interdisciplinary student project mechanical engineers work together with textile engineers and designers. The developed textiles combine electronic engineering, measurement technologies and clothing technologies. The goal is to make movement and muscle activity measurable with just the clothing.",
    description_de: "Die Professur hat zusammen mit der Fakultät für Textil und Design der Hochschule Reutlingen ein gemeinsames Entwicklungsvorhaben gestartet. Im Rahmen eines Interdisziplinären Studentenprojektes arbeiten Maschinenbauer, Textilingenieure und Designer an der Entwicklungen technischer Textilien. Diese Textilien sollen Elektrotechnik, Messtechnik und Bekleidungstechnik miteinander vereinen. Das Ziel ist, Bewegungen und Muskelaktivitäten des Sportlers über die Bekleidung messbar zu machen.",
    leader: "Aljoscha Hermann",
    partner: "School of Textiles & Design at the University Reutlingen",
    funding: "Others",
    funding_de: "Sonstige",
    status: "Finished",
    status_de: "Abgeschlossen",
    start: " 04/10/2016",
    end: "27/01/2017",
    'Sportart 0': "Alle Sportarten - Sport allgmeine",
    'Sportart 1': "Ski und Snowboard",
    'Sportart 2': "",
    'Forschungsziel 2': "Sicherheit",
    'Forschungsziel 1': "Nutzungserlebnis",
    'Forschungsziel 0': "",
    'Forschungsfeld 1': "Physiologie",
    'Forschungsfeld 2': "Materialwissenschaft",
    'Forschungsfeld 0': "Biomechanik"
}

var P3 = {
    Thema: "Sky-Running",
    Thema_de: "Sky-Running",
    title: "Comparing trail running shoes with respect to the traction",
    title_de: "Vergleich Trail Laufschuhe in Bezug auf die Traktion",
    description: "Trail running is a sport takes place on hiking trails and often in mountain terrain. The reports show a growing interest since 2012.As shoes are the only equipment of the athletes interacts to the ground; they can influence levels of performance and injuries. The research study evaluates interaction between shoe and surface in two parts, Subjective and Objective measurement. In the subjective measurement, five factors traction, stability, weight, comfort and cushioning are compared among 11 armature Trail-runners in different surface conditions. In the objective tests, rotational traction are compared among three running shoes.",
    description_de: "Trail Laufen ist ein Sport findet auf Wanderwegen und oft in den Bergen.Der Bericht zeigt steigendes Intersse seit 2012. Schuhe sind die einzige Ausrüstung für Athleten um mit dem Untergrund zu interagieren.Sie haben Einfluss auf das Level der Leistung sowie mögliche Verletzungen. Die Forschungsstudie evaluiert die Interaktion zwischen Schuh und Untergrund in zwei Teilen, subjektive und objektive Messungen.In den subjektiven Messungen werden fünf Faktoren (Traktion, Stabilität, Gewicht, Komfort und Polsterung) bei 11 trail-runners verglichen, in verschiedenen Untergrund-Bedingungen.In den objektiven Testungen wird die Rotations-Traktion bei drei verschiedenen Laufschuhen verglichen. ",
    leader: "Robert Pilz",
    partner: "Prof. Veit Senner",
    funding: "others",
    funding_de: "Wirtschaft",
    status: "Finished",
    status_de: "Abgeschlossen",
    start: "07/01/2016",
    end: "20/04/2016",
    'Sportart 0': "Laufen & Trailrunning",
    'Sportart 1': "",
    'Sportart 2': "",
    'Forschungsziel 2': "Sicherheit",
    'Forschungsziel 1': "Nutzungserlebnis",
    'Forschungsziel 0': "Leistung",
    'Forschungsfeld 1': "Psychologie",
    'Forschungsfeld 2': "Materialwissenschaft",
    'Forschungsfeld 0': "Biomechanik"
}

var P4 = {
    Thema: "Sustainability",
    Thema_de: "Nachhaltigkeit",
    title: "Sustainable Fitness Service",
    title_de: "Nachhaltige Fitnessdienstleistung",
    description: "The observation that not only the elderly but also the younger generation is increasingly suffering from chronic physical and mental problems requires measures not only from the public stake holders but also from the individual itself. The focus however should be on preventive measures and in particular on activities which enable intrinsic motivation for a sports oriented active life style. This is supported by the fact, that many studies confirm the positive effect of such kind of living on wellbeing, physical and mental health. One inherent problem of the commercial fitness sector however is its constantly high drop-out-rate of their members. Our research has shown that one reason for drop-out is the discrepancy between the clients’ desired and their de facto achieved fitness improvements. These differences in expectations, which very often results in abandoning the started activity, have to be seen critical with respect to life-long and sustainable self-management of health.",
    description_de: "Immer häufiger prägen chronische Leiden das Krankheitsbild auch von jüngeren Generationen. Unter Annahme mündiger Verbraucher erfordert dies aber nicht nur von öffentlichen Stellen Maßnahmen, sondern auch vom jedem einzelnen selbst. Prävention durch einen aktiven Lebensstil gilt schon lange als vielversprechend. Vor dem inhärenten Problem hoher Drop-Out Raten der Fitnessbranche rücken immer mehr motivationale Aspekte in den Vordergrund, mitunter begründet in der großen Diskrepanz zwischen Erwartungshaltung und Zielerreichung des Kunden. Dieses Forschungsprojekt mit der Deutschen Hochschule für Prävention und Gesundheitsmanagement soll daher die Motivationsstruktur der Fitnesskunden analysieren, motivationale Aspekte der Fitnessindustrie identifizieren und motivierende Trainings konzeptionieren, um einen lebenslangen aktiven Lebensstil zu fördern.",
    leader: "Philipp Kopp",
    partner: "",
    funding: "public with industry",
    status: "Running",
    status_de: "Laufend",
    start: "01/06/2015",
    end: "n.a.",
    'Sportart 0': "Alle Sportarten - Sport allgmeine",
    'Sportart 1': "Fitness Allgemein",
    'Sportart 2': "",
    'Forschungsziel 2': "Leistung",
    'Forschungsziel 1': "Nutzungserlebnis",
    'Forschungsziel 0': "",
    'Forschungsfeld 1': "Psychologie",
    'Forschungsfeld 2': "Physiologie",
    'Forschungsfeld 0': ""
}

var P5 = {
    Thema: "KNEEMAX®",
    Thema_de: "KNEEMAX®",
    title: "KNEEMAX®",
    title_de: "KNEEMAX®",
    description: "KNEEMAX® is a protective device for the knee joint, in particular the anterior cruciate ligament, and the lower leg for expert skiers, as well as for recreational skiers. This studies aims to quantify the effect of KNEEMAX® regarding the load reduction on the ligamental structures of the knee. The investigation is performed using the artifical knee of the Group of Sport Equipment and Materials.",
    description_de: "KNEEMAX® is a protective device for the knee joint, in particular the anterior cruciate ligament, and the lower leg for expert skiers, as well as for recreational skiers. This studies aims to quantify the effect of KNEEMAX® regarding the load reduction on the ligamental structures of the knee. The investigation is performed using the artifical knee of the Group of Sport Equipment and Materials.",
    leader: "Aljoscha Hermann",
    partner: "",
    funding: "industry, commerce",
    status: "Running",
    status_de: "Laufend",
    start: "01/06/2015",
    end: "n.a.",
    'Sportart 0': "Ski und Snowboard",
    'Sportart 1': "",
    'Sportart 2': "",
    'Forschungsziel 2': "Sicherheit",
    'Forschungsziel 1': "",
    'Forschungsziel 0': "",
    'Forschungsfeld 1': "Biomechanik",
    'Forschungsfeld 2': "Materialwissenschaft",
    'Forschungsfeld 0': ""
}

var pProjects = [P1,P2,P3,P4,P5]


/**IMPORT RESEARCH DATA FROM XLS**/
var pData = [];

$.ajax({
    url: '../spgm-hiwi/database/AlleStudienarbeiten-Spgm.xml',
    type: 'GET',
    dataType: 'xml',
    success: function (returnedXMLResponse) {
        $(returnedXMLResponse).find('Row').each(function () {
            var rowArray = []; // sub array
            /* loop over each cell */
            $('Data', this).each(function () {
                rowArray.push($(this).text());
            });
            /* push row into main array */
            pData.push(rowArray);
        })
    }
});

function copyMatrix (asa){
    i = asa.length;
    b = Array(i);
    while (i--) {
        b[i] = asa[i];
    }
    return b
}

function convertToArrayOfObjects(data) {
    var keys = data.shift(),
        i = 0, k = 0,
        obj = null,
        output = [];

    for (i = 0; i < data.length; i++) {
        obj = {};

        for (k = 0; k < keys.length; k++) {
            obj[keys[k]] = data[i][k];
        }

        output.push(obj);
    }

    return output;
}


function createListElement(projectName) {
    var elementList = '<li class="menuEle2" id="'+myI+'">' + projectName + '</li>'
    return elementList;
}

function whoIs (obj){
    console.log(obj)
}

function storeI(b) {
    myI = b;
}

/**FILTERING **/

/*Find selected clicks*/
function getSports() {
    var ids = [];
    $('.spSel').each(function(){
        ids.push(this.id);
    });
    return ids;
}

function getGoal() {
    var ids = [];
    $('.spSelG').each(function(){
        ids.push(this.id);
    });
    return ids;
}

function getField() {
    var ids = [];
    $('.spSelR').each(function(){
        ids.push(this.id);
    });
    return ids;
}


function filterRating(value) {
    return value[field] == type;
}

function storeField(b) {
    field = b;
}

function storeType(b) {
    type = b;
}

function filterSports () {
    var sArray = ['Forschungsziel 2','Sportart 1', 'Sportart 2', 'Sportart 3'];
    var sType = getSports();
    var myArray = [];
    var oldArray = convertToArrayOfObjects(copyMatrix(pData));
    debugger;
    if (sType.length == 0) {
        return oldArray;
    } else {
        for (i in sArray) {
        storeField(sArray[i]);
        for (j in sType) {
            storeType(sType[j]);
            var newArray = oldArray.filter(filterRating);
            myArray = myArray.concat(newArray);
            }
        }
        return myArray;
    }  
}

function filterSports2 (sArray, sType, oldArray, sMode) {
    var myArray = [];
    if (sType.length == 0) {
        return oldArray;
    } else if (sMode=="OR") {
        for (i in sArray) {
        storeField(sArray[i]);
        for (j in sType) {
            storeType(sType[j]);
            var newArray = oldArray.filter(filterRating);
            myArray = myArray.concat(newArray);
            }
        }
        return myArray;
    }  else if (sMode=="AND") {
        for (j in sType) {
            storeType(sType[j]);
            var inCommon = 0;
            for (i in sArray) {
                storeField(sArray[i]);
                var newArray = oldArray.filter(filterRating);
                myArray = myArray.concat(newArray);
                if (newArray.length != 0) {
                    inCommon = 1;
                    }
            }
            oldArray = copyMatrix(myArray);
            myArray = [];
            if (inCommon == 0) {
                return myArray;
            }
        }
        return oldArray;
    } 
}

function filterProjects() {
    var sArray = ['Sportart 0','Sportart 1', 'Sportart 2'];
    var sType = getSports();
    var sMode = spMode;
    var sSource = filterSports2 (sArray, sType, pProjects, sMode);
    
    var gArray = ['Forschungsziel 2', 'Forschungsziel 1', 'Forschungsziel 0']
    var gType = getGoal();
    var gMode = gpMode;
    var gSource = filterSports2 (gArray, gType, sSource, gMode);
    
    var fArray = ['Forschungsfeld 1', 'Forschungsfeld 2', 'Forschungsfeld 0']
    var fType = getField();
    var fMode = fpMode;
    var fSource = filterSports2 (fArray, fType, gSource, fMode);
    
    return fSource;
}

function filterResearch() {
    var sArray = ['Forschungsziel 2','Sportart 1', 'Sportart 2', 'Sportart 3'];
    var sType = getSports();
    var sMode = spMode;
    var sSource = filterSports2 (sArray, sType, convertToArrayOfObjects(copyMatrix(pData)), sMode);
    
    var gArray = ['Forschungsfeld 2', 'Forschungsziel 1']
    var gType = getGoal();
    var gMode = gpMode;
    var gSource = filterSports2 (gArray, gType, sSource, gMode);
    
    var fArray = ['Forschungsfeld 1', 'Datum']
    var fType = getField();
    var fMode = fpMode;
    var fSource = filterSports2 (fArray, fType, gSource, fMode);
    
    return fSource;
}

function updateFilter () {
    pObj = filterProjects();
    rObj = filterResearch();
    $('#rCounter').html(rObj.length);
    $('#pCounter').html(pObj.length);
    Sports = getSports();
    Field = getField();
    Goal = getGoal();
    Selected = Sports.length + Field.length + Goal.length;
    Mode = [spMode, gpMode, fpMode]
}

function rememberClicked () {
    for (i in Sports) {
        $('[id="'+Sports[i]+'"]').toggleClass("spSel")
    } for (i in Field) {
        $('[id="'+Field[i]+'"]').toggleClass("spSelR")
    } for (i in Goal) {
        $('[id="'+Goal[i]+'"]').toggleClass("spSelG")
    } if (Mode[0]=="AND") {$('.sLabel').click();};
    if (Mode[1]=="AND") {$('.gLabel').click();};
    if (Mode[2]=="AND") {$('.fLabel').click();};
}

function changeMode (value) {
    if (value == "OR") {
        return ("AND")
    } else {
        return ("OR")
    }
}

